网络层-ICMP协议：

		网际控制报文协议（Internet Control Message Protocol）

		作用：
			辅助IP协议进行数据的传输
			报告传输中发生的错误信息和异常情况


		数据帧的格式：
			帧首部 + 帧的数据内容 + 帧尾部

		帧的数据内容 = IP数据报
		IP数据报的格式：
			IP数据报首部 + IP数据报的数据

		IP数据报的数据 = ICMP数据报（封装在IP数据报的数据里面，是里面的一组数据）
		ICMP数据报的格式：
			ICMP报文首部 + ICMP报文数据

		在IP数据报的首部里面有个 “协议(8位)” 字段
		它表明了IP数据具体是什么协议的，若是ICMP协议，则会把 “1”——代表是ICMP协议 写入这里的 “协议(8位)” 字段


		ICMP报文首部的格式：
			第一行：类型(8位) + 代码(8位) + 校验和(16位)
			第二行：报文数据(32位)


			类型(8位)，ICMP协议有两大类型：
				1.差错报告报文
				2.询问报文

			差错报告报文有以下几种：

				ICMP报文种类  类型的值(填入类型8位的值)   报文类型   具体代码(填入代码8位的值)
								3（终点不可达）		   网络不可达        0
								3（终点不可达）		   主机不可达        1
				差错报告报文		5（重定向）		       网络不可达        0
								5（重定向）       	   网络不可达        1
								11 			    	   传输超时        	-
								12			      	   坏的IP头        	0
								12       	  		   缺少其他必要参数   1


			询问报文有以下几种：

				ICMP报文种类  类型的值(填入类型8位的值)   报文类型     具体代码(填入代码8位的值)
									0或8		   	回送(Echo)请求或应答      	-
				询问报文				13或14	时间戳(Timestamp)请求或应答    	-








ICMP协议的应用：

		1.Ping应用（验证网络质量）

			Ping的原理：1.是使用ICMP协议的询问报文中的 “回送(Echo)请求或应答”
					   2.我们使用Ping命令时，它首先会组装一个 “IP协议的数据报”，在IP数据报里它会组装一个 “ICMP协议” 的 “询问报文”，并封装到IP数据报的数据内容部分里面去
					   3.然后通过数据链路层发送出去

			我们使用Ping命令时，看到它显示是32字节的数据
			也就是说Ping命令封装的IP数据报总共有32字节，前面我们学到，IP数据报首部至少有20字节
			所以剩下的12字节就是IP数据报的数据，即ICMP数据报的长度


			拓展：
				当家里网络出现问题是，我们可以这样排查：
				1.Ping本地回环地址：127.0.0.1，若Ping不通，则说明本地协议栈出现了问题（重装系统或重装协议栈）
				2.若第一步能Ping通，则Ping网关的地址（即路由器的地址）(使用ipconfig /all可以查看默认网关)
					路由器地址一般为：192.168.0.1  或  192.168.1.1
					若Ping通则说明本机到路由器的通路是OK的，若Ping不通，则说明wifi或网线连接有问题
				3.若第二步能Ping通，则Ping外部网络地址（如Ping百度）
					若Ping不通，则说明本地到地区ISP的连接是故障的，这时候就需要联系地区ISP来解决故障


		2.Traceroute应用
			（用来探查IP数据报在网络中走过的路径）
				我们知道计算机是连接在一个虚拟的网络中的，我们并不需要关系实际的物理网络细节，但若需要对网络故障进行排查，就可以使用Traceroute来了解具体的网络是怎样的

			Traceroute的原理：
				回顾前面学习的IP协议中IP数据报的首部中，有一个TTL的字段
				生存时间TTL(8位)：为IP数据报在网络中的寿命，每经过一个设备，TTL-1，当TTL=0时，网络设备必须丢弃该IP报文
					————丢弃IP报文是怎么处理的呢？
				
				若网络设备要丢弃一个IP报文时，它将发出一个 “终点不可达” 的 “差错报告报文” 的ICMP协议报文返回给源主机，即它会报告一个错误，告诉源端的主机的传输发生了错误，这样才会让源主机察觉这里出现了问题

				Traceroute的原理就是利用TTL=0时，设备会向源端主机发送错误报告的机制，来记录网络路径

				例：
					计算机A、计算机C连接在一个虚拟的互连网络中，假设网络拓扑如下：
					(------->链路连接到)

					计算机A------->中型网络a------->大型网络b------->中型网络c------->小型网络d------->计算机C

					Traceroute工作过程：
					1.计算机ATraceroute首先会封装一个TTL=1的IP报文，数据逐跳来到中型网络a
					2.中型网络a收到IP报文，发现TTL-1后=0，就会往源机器(计算机A)返回发出一个封装有 “终点不可达” 的ICMP报文的IP报文，计算机A就会把中型网络a的IP地址记录下来
					3.计算机ATraceroute再封装一个TTL=2的IP报文，数据进行了两次逐跳，来到大型网络b
					4.大型网络b收到IP报文，逐跳了2次，TTL这时=0了，就往源机器(计算机A)返回一个封装有 “终点不可达” 的ICMP报文的IP报文，计算机A又把大型网络b的IP地址记录下来
					5.以此类推，Traceroute封装一个TTL=3、TTL=4，获得中型网络c、小型网络d的IP地址
					6.数据最后到达计算机B，计算机B发出一个回应的报文，表示说你发出的数据我已经收到了
					7.这时候，计算机A已经记录下来传输路径中所有节点的信息，这就可以输出这个数据报在网络中走过的路径了


				cmd下命令行 “tracert + 域名” 就可以查看本机到某个域名的路径信息的输出